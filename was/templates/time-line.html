{% extends "layouts/base.html" %}

{% block title %} Timeline {% endblock %} 

{% block stylesheets %}
<link rel="stylesheet" href="/static/assets/css/jqcloud.min.css">
<link rel="stylesheet" href="/static/assets/css/right_box.css">
{% endblock stylesheets %}

{% block content %}

<div class="pcoded-content">
    <div class="pcoded-inner-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="page-header-title">
                            <h5 class="m-b-10">Timeline</h5>
                        </div>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/"><i class="feather icon-home"></i></a></li>
                            <li class="breadcrumb-item"><a href="javascript:">{{url}}</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <div class="main-body">
            <div class="page-wrapper">
                <!-- [ Main Content ] start -->
                <div class="row">
                    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
                    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
                    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
                    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
                    <link rel="stylesheet" type="text/css" href="/static/assets/css/jquery.datetimepicker.css"/ >
                    <script src="/static/assets/js/jquery.datetimepicker.full.min.js"></script>

                    {{mms|json_script:'dict-id-m'}}
                    {{calllog|json_script:'dict-id-c'}}
                    {{chromeurlhistory|json_script:'dict-id-ch'}}
                    {{Samurlhistory|json_script:'dict-id-s'}}
                    {{webext|json_script:'dict-id-d'}}
                    {{media|json_script:'dict-id-md'}}
                    <script type="text/javascript">
                        // Themes begin
                        am4core.useTheme(am4themes_animated);
                        // Themes end

                        var chart = am4core.create("chartdiv", am4charts.XYChart);

                        var mprofile = document.getElementById("dict-id-m").textContent
                        var mprofileJson = JSON.parse(mprofile)

                        var cprofile = document.getElementById("dict-id-c").textContent
                        var cprofileJson = JSON.parse(cprofile)

                        var chprofile = document.getElementById("dict-id-ch").textContent
                        var chprofileJson = JSON.parse(chprofile)

                        var sprofile = document.getElementById("dict-id-s").textContent
                        var sprofileJson = JSON.parse(sprofile)

                        var dprofile = document.getElementById("dict-id-d").textContent
                        var dprofileJson = JSON.parse(dprofile)

                        var mdprofile = document.getElementById("dict-id-md").textContent
                        var mdprofileJson = JSON.parse(mdprofile)

                        var mSize = "{{mms|length}}" // 마커 개수
                        var cSize = "{{calllog|length}}"
                        var chSize = "{{chromeurlhistory|length}}"
                        var sSize = "{{Samurlhistory|length}}"
                        var dSize = "{{webext|length}}"
                        var mdSize = "{{media|length}}"

                        var startDate = 0
                        var endDate = 0

                        var mDate = 0
                        var cDate = 0
                        var chDate = 0
                        var sDate = 0
                        var dDate = 0
                        var mdDate = 0

                        for (var i = 0; i < mSize; i++) {
                            mDate = new Date(mprofileJson[i][3])

                            if (i == 0) {
                                startDate = mDate
                            }

                            if (i == mSize - 1) {
                                endDate = mDate
                            }
                        }

                        for (var i = 0; i < cSize; i++) {
                            cDate = new Date(mprofileJson[i][3])

                            if (cDate < startDate) {
                                startDate = cDate
                            }

                            if (cDate > endDate) {
                                endDate = cDate
                            }
                        }

                        for (var i = 0; i < chSize; i++) {
                            chDate = new Date(chprofileJson[i][3])

                            if (chDate < startDate) {
                                startDate = chDate
                            }

                            if (chDate > endDate) {
                                endDate = chDate
                            }
                        }

                        for (var i = 0; i < sSize; i++) {
                            sDate = new Date(sprofileJson[i][3])

                            if (sDate < startDate) {
                                startDate = sDate
                            }

                            if (sDate > endDate) {
                                endDate = sDate
                            }
                        }
                        
                        for (var i = 0; i < dSize; i++) {
                            dDate = new Date(dprofileJson[i][1])
                            
                            if (dDate < startDate) {
                                startDate = dDate
                            }

                            if (dDate > endDate) {
                                endDate = dDate
                            }
                        }

                        for (var i = 0; i < mdSize; i++) {
                            mdDate = new Date(mdprofileJson[i][1])
                            
                            if (mdDate < startDate) {
                                startDate = mdDate
                            }

                            if (mdDate > endDate) {
                                endDate = mdDate
                            }
                        }

                        var data = [];

                        var messages = 0;
                        var calls = 0;
                        var internet = 0;
                        var downloads = 0;
                        var media = 0;

                        var mCount = 0;
                        var cCount = 0;
                        var iCount = 0;
                        var dCount = 0;
                        var mdCount = 0;

                        var imsi = startDate
                        imsi.setHours(imsi.getHours() - 1)

                        for (let i = 0; ; i++) {
                            imsi.setHours(imsi.getHours() + 1)

                            if (imsi.getHours() > endDate.getHours() && imsi.getDate() > endDate.getMonth() && imsi.getMonth() > endDate.getMonth() && imsi.getFullYear() >= endDate.getFullYear()) {
                                break;
                            }
                            
                            mCount = 0
                            for (var m = 0; m < mSize; m++) {
                                mDate = new Date(mprofileJson[m][3])
                                if (mDate.getHours() == imsi.getHours() && mDate.getDate() == imsi.getDate() && mDate.getMonth() == imsi.getMonth() && mDate.getFullYear() == imsi.getFullYear()) {
                                    mCount += 1;
                                }
                            }
                            messages = mCount;

                            cCount = 0
                            for (var c = 0; c < cSize; c++) {
                                cDate = new Date(cprofileJson[c][2])
                                if (cDate.getHours() == imsi.getHours() && cDate.getDate() == imsi.getDate() && cDate.getMonth() == imsi.getMonth() && cDate.getFullYear() == imsi.getFullYear()) {
                                    cCount += 1;
                                }
                            }
                            calls = cCount

                            iCount = 0
                            for (var ch = 0; ch < chSize; ch++){
                                chDate = new Date(chprofileJson[ch][3])
                                if (chDate.getHours() == imsi.getHours() && chDate.getDate() == imsi.getDate() && chDate.getMonth() == imsi.getMonth() && chDate.getFullYear() == imsi.getFullYear()) {
                                    iCount += 1;
                                }
                            }
                            for(var s = 0; s < sSize; s++){
                                sDate = new Date(sprofileJson[s][3])
                                if (sDate.getHours() == imsi.getHours() && sDate.getDate() == imsi.getDate() && sDate.getMonth() == imsi.getMonth() && sDate.getFullYear() == imsi.getFullYear()) {
                                    iCount += 1;
                                }
                            }
                            internet = iCount

                            dCount = 0
                            for(var d = 0; d < dSize; d++){
                                dDate = new Date(dprofileJson[d][1])
                                if (dDate.getHours() == imsi.getHours() && dDate.getDate() == imsi.getDate() && dDate.getMonth() == imsi.getMonth() && dDate.getFullYear() == imsi.getFullYear()) {
                                    dCount += 1;
                                }
                            }
                            downloads = dCount

                            mdCount = 0
                            for(var md = 0; md < mdSize; md++){
                                mdDate = new Date(mdprofileJson[md][1])
                                if (mdDate.getHours() == imsi.getHours() && mdDate.getDate() == imsi.getDate() && mdDate.getMonth() == imsi.getMonth() && mdDate.getFullYear() == imsi.getFullYear()) {
                                    mdCount += 1;
                                }
                            }
                            media = mdCount

                            /*mCount -= Math.round((Math.random() < 0.5 ? 1 : -1) * Math.random() * 10);
                            cCount -= Math.round((Math.random() < 0.5 ? 1 : -1) * Math.random() * 10);

                            if (mCount < 0) {
                            mCount = Math.round(Math.random() * 10);
                            }
                            if (cCount < 0) {
                                cCount = Math.round(Math.random() * 10);
                            }

                            messages = mCount
                            calls = cCount*/
                            
                            data.push({ hour: new Date(imsi.getFullYear(), imsi.getMonth(), imsi.getDate(), imsi.getHours()), messages: messages, calls: calls, internet: internet, downloads: downloads, media: media});
                        }

                        chart.data = data;

                        chart.dateFormatter.inputDateFormat = "HH";
                        var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
                        dateAxis.renderer.minGridDistance = 100;
                        dateAxis.startLocation = 0.5;
                        dateAxis.endLocation = 0.5;
                        dateAxis.baseInterval = {
                        timeUnit: "hour",
                        count: 1
                        }

                        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
                        valueAxis.tooltip.disabled = true;

                        // Create series
                        var series = chart.series.push(new am4charts.LineSeries());
                        series.dataFields.dateX = "hour";
                        series.name = "메시지";
                        series.dataFields.valueY = "messages";
                        series.tooltipHTML = "<span style='font-size:14px; color:#000000;'><i class='fas fa-envelope' style='vertical-align:center; width:28px; height:21px;'></i><b>{valueY.value}</b></span>";
                                            
                        series.tooltip.background.fill = am4core.color("#FFF");
                        series.tooltip.getStrokeFromObject = true;
                        series.tooltip.background.strokeWidth = 3;
                        series.tooltip.getFillFromObject = false;
                        series.fillOpacity = 0.6;
                        series.strokeWidth = 2;
                        series.stacked = true;

                        series.tooltip.pointerOrientation = "vertical";

                        var series2 = chart.series.push(new am4charts.LineSeries());
                        series2.dataFields.dateX = "hour";
                        series2.name = "통화";
                        series2.dataFields.valueY = "calls";
                        series2.tooltipHTML = "<span style='font-size:14px; color:#000000;'><i class='fas fa-phone' style='vertical-align:center; width:28px; height:21px;'></i><b>{valueY.value}</b></span>";
                        series2.tooltip.background.fill = am4core.color("#FFF");
                        series2.tooltip.getFillFromObject = false;
                        series2.tooltip.getStrokeFromObject = true;
                        series2.tooltip.background.strokeWidth = 3;
                        series2.sequencedInterpolation = true;
                        series2.fillOpacity = 0.6;
                        series2.strokeWidth = 2;
                        series2.stacked = true;

                        series2.tooltip.pointerOrientation = "vertical";

                        var series3 = chart.series.push(new am4charts.LineSeries());
                        series3.dataFields.dateX = "hour";
                        series3.name = "인터넷";
                        series3.dataFields.valueY = "internet";
                        series3.tooltipHTML = "<span style='font-size:14px; color:#000000;'><i class='fas fa-globe' style='vertical-align:center; width:28px; height:21px;'></i><b>{valueY.value}</b></span>";
                        series3.tooltip.background.fill = am4core.color("#FFF");
                        series3.tooltip.getFillFromObject = false;
                        series3.tooltip.getStrokeFromObject = true;
                        series3.tooltip.background.strokeWidth = 3;
                        series3.sequencedInterpolation = true;
                        series3.fillOpacity = 0.6;
                        series3.strokeWidth = 2;
                        series3.stacked = true;

                        series3.tooltip.pointerOrientation = "vertical";

                        var series4 = chart.series.push(new am4charts.LineSeries());
                        series4.dataFields.dateX = "hour";
                        series4.name = "다운로드";
                        series4.dataFields.valueY = "downloads";
                        series4.tooltipHTML = "<span style='font-size:14px; color:#000000;'><i class='fas fa-download' style='vertical-align:center; width:28px; height:21px;'></i><b>{valueY.value}</b></span>";
                        series4.tooltip.background.fill = am4core.color("#FFF");
                        series4.tooltip.getFillFromObject = false;
                        series4.tooltip.getStrokeFromObject = true;
                        series4.tooltip.background.strokeWidth = 3;
                        series4.sequencedInterpolation = true;
                        series4.fillOpacity = 0.6;
                        series4.strokeWidth = 2;
                        series4.stacked = true;

                        series4.tooltip.pointerOrientation = "vertical";

                        var series4 = chart.series.push(new am4charts.LineSeries());
                        series4.dataFields.dateX = "hour";
                        series4.name = "미디어";
                        series4.dataFields.valueY = "media";
                        series4.tooltipHTML = "<span style='font-size:14px; color:#000000;'><i class='fas fa-image' style='vertical-align:center; width:28px; height:21px;'></i><b>{valueY.value}</b></span>";
                        series4.tooltip.background.fill = am4core.color("#FFF");
                        series4.tooltip.getFillFromObject = false;
                        series4.tooltip.getStrokeFromObject = true;
                        series4.tooltip.background.strokeWidth = 3;
                        series4.sequencedInterpolation = true;
                        series4.fillOpacity = 0.6;
                        series4.strokeWidth = 2;
                        series4.stacked = true;

                        series4.tooltip.pointerOrientation = "vertical";

                        chart.cursor = new am4charts.XYCursor();
                        chart.cursor.xAxis = dateAxis;

                        chart.scrollbarX = new am4core.Scrollbar();

                        // Add a legend
                        chart.legend = new am4charts.Legend();
                        chart.legend.position = "top";
                    </script>
                    
                    <div class="col-sm-12">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active text-uppercase" id="timeline-tab" data-toggle="tab" href="#timeline" role="tab" aria-controls="timeline" aria-selected="true">Stacked Chart</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-uppercase" id="result-tab" data-toggle="tab" href="#result" role="tab" aria-controls="result" aria-selected="false">Result</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="timeline" role="tabpanel" aria-labelledby="timeline-tab">
                                <!-- [ Stacked Chart ] start -->
                                <div class="card">
                                    <div class="card-block2">
                                        <div id="chartdiv"></div>
                                        <!-- Chart code -->
                                    </div>
                                </div>
                                <!-- [ Stacked Chart ] end -->
                            </div>
                            <div class="tab-pane fade" id="result" role="tabpanel" aria-labelledby="result-tab">
                                <div class="col-xl-12">
                                    <div class="card" style="margin-bottom: 15px;">
                                        <div class="card-header">
                                            <h5>Duration</h5>
                                            <form id="duration" style="text-align: center;">
                                                <input id="datetimepicker1" type="text" onchange="send1(this.value)" style="text-align: center;">
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                <input id="datetimepicker2" type="text" onchange="send2(this.value)" style="text-align: center;">
                                                &nbsp;&nbsp;&nbsp;
                                            </form>
                                        </div>
                                    </div>
                                    <div class="card" style="margin-bottom: 15px;">
                                        <div class="card-header">
                                            <h5>Result</h5>
                                        </div>
                                        <div class="card-block table-border-style">
                                            <div style="text-align: right; padding: 0px 0px 30px 0px;">
                                                <select id="contents" onchange="cont()">
                                                    <option value="all" selected="selected">전체
                                                    <option value="msg">메시지
                                                    <option value="call">통화
                                                    <option value="internet">인터넷
                                                    <option value="download">다운로드
                                                    <option value="media">미디어
                                                </select>
                                            </div>
                                            <script>
                                                var arr = [];
                                                for (var i=0; i<mSize; i++){
                                                    mprofileJson[i].splice(0, 0, 'm')
                                                    var temp = mprofileJson[i][1];
                                                    mprofileJson[i][1] = new Date(mprofileJson[i][4]);
                                                    mprofileJson[i][4] = temp;      
                                                    if (mprofileJson[i][3] == null){
                                                        mprofileJson[i][3] = ''
                                                    }            
                                                    arr.push(mprofileJson[i]);
                                                }                         
                                                for (var i=0; i<cSize; i++){
                                                    cprofileJson[i].splice(0, 0, 'c')
                                                    var temp = cprofileJson[i][1];
                                                    cprofileJson[i][1] = new Date(cprofileJson[i][3]);
                                                    cprofileJson[i][3] = temp; 
                                                    arr.push(cprofileJson[i]);
                                                }
                                                for (var i=0; i<chSize; i++){
                                                    chprofileJson[i].splice(0, 0, 'i')
                                                    chprofileJson[i].splice(5, 0, 'ch')
                                                    var temp = chprofileJson[i][1];
                                                    chprofileJson[i][1] = new Date(chprofileJson[i][4]);
                                                    chprofileJson[i][4] = temp;                  
                                                    arr.push(chprofileJson[i]);
                                                }
                                                for (var i=0; i<sSize; i++){
                                                    sprofileJson[i].splice(0, 0, 'i')
                                                    sprofileJson[i].splice(5, 0, 's')
                                                    var temp = sprofileJson[i][1];
                                                    sprofileJson[i][1] = new Date(sprofileJson[i][4]);
                                                    sprofileJson[i][4] = temp;                  
                                                    arr.push(sprofileJson[i]);
                                                }
                                                for (var i=0; i<dSize; i++){
                                                    dprofileJson[i].splice(0, 0, 'd')
                                                    var temp = dprofileJson[i][1];
                                                    dprofileJson[i][1] = new Date(dprofileJson[i][2]);
                                                    dprofileJson[i][2] = temp; 
                                                    if (dprofileJson[i][3] == null){
                                                        dprofileJson[i][3] = ''
                                                    }
                                                    if (dprofileJson[i][4] == null){
                                                        dprofileJson[i][4] = ''
                                                    }
                                                    arr.push(dprofileJson[i]);
                                                }
                                                for (var i=0; i<mdSize; i++){
                                                    mdprofileJson[i].splice(0, 0, 'md')
                                                    var temp = mdprofileJson[i][1];
                                                    mdprofileJson[i][1] = new Date(mdprofileJson[i][2]);
                                                    mdprofileJson[i][2] = temp; 
                                                    arr.push(mdprofileJson[i]);
                                                }

                                                arr.sort(function(a, b){
                                                    return a[1] - b[1];
                                                });

                                                var startDate = arr[0][1];
                                                var endDate = arr[arr.length - 1][1];

                                                let tmpDate = startDate.getFullYear() + '/' + leadingZeros(startDate.getMonth() + 1, 2) + '/' + leadingZeros(startDate.getDate(), 2) + ' ' + leadingZeros(startDate.getHours(), 2) + ':' + '00';
                                                $('#datetimepicker1').val(tmpDate);
                                                $('#datetimepicker1').datetimepicker();
                                                tmpDate = endDate.getFullYear() + '/' + leadingZeros(endDate.getMonth() + 1, 2) + '/' + leadingZeros(endDate.getDate(), 2) + ' ' + leadingZeros(endDate.getHours() + 1, 2) + ':' + '00';
                                                $('#datetimepicker2').val(tmpDate);
                                                $('#datetimepicker2').datetimepicker();

                                                function leadingZeros(n, digits) {
                                                    var zero = '';
                                                    n = n.toString();

                                                    if (n.length < digits) {
                                                        for (var i = 0; i < digits - n.length; i++)
                                                        zero += '0';
                                                    }
                                                    return zero + n;
                                                }

                                                function send1(str){
                                                    startDate = new Date(str)
                                                    cont()
                                                }

                                                function send2(str){
                                                    endDate = new Date(str)
                                                    cont()
                                                }

                                                function cont(){
                                                    var tb = $("#contenthere");
                                                    var state;
                                                    var browser;
                                                    
                                                    if (document.getElementById('contents').value == 'all'){
                                                        tb.empty();

                                                        for (var i=0; i<arr.length; i++){
                                                            if (arr[i][0] == 'm'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][5] == '2'){
                                                                        state = '발신'
                                                                    }else{
                                                                        state = '수신'
                                                                    }
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td style="width: 10%;">' + '<i class="fas fa-envelope"></i>' + '</td>' + 
                                                                    '<td style="width: 22.5%;">' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">상태</p>' + state + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">번호</p>' + arr[i][2] + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">내용</p>' + arr[i][3] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                            if (arr[i][0] == 'c'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][5] == '2'){
                                                                        state = '발신'
                                                                    }else if(arr[i][5] == '1'){
                                                                        state = '수신'
                                                                    }else{
                                                                        state = '부재중'
                                                                    }
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td style="width: 10%;">' + '<i class="fas fa-phone"></i>' + '</td>' + 
                                                                    '<td style="width: 22.5%;">' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">상태</p>' + state + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">번호</p>' + arr[i][2] + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">통화 시간</p>' + arr[i][4] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                            if (arr[i][0] == 'i'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][5] == 'ch'){
                                                                        browser = 'Chrome'
                                                                    }else if(arr[i][5] == 's'){
                                                                        browser = 'Samsung Internet'
                                                                    }
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td style="width: 10%;">' + '<i class="fas fa-globe"></i>' + '</td>' + 
                                                                    '<td style="width: 22.5%;">' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">브라우저</p>' + browser + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">URL</p>' + arr[i][2] + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">Title</p>' + arr[i][3] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                            if (arr[i][0] == 'd'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td style="width: 10%;">' + '<i class="fas fa-download"></i>' + '</td>' + 
                                                                    '<td style="width: 22.5%;">' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">다운로드 도구</p>' + arr[i][3] + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">URI</p>' + arr[i][4] + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">다운로드 위치</p>' + arr[i][5] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                            if (arr[i][0] == 'md'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][4] == 'com.android.chrome'){
                                                                        browser = 'Download (Chrome)'
                                                                    }else if(arr[i][4] == 'com.sec.android.app.sbrowser'){
                                                                        browser = 'Download (Samsung Internet)'
                                                                    }else{
                                                                        browser = arr[i][3]
                                                                    }
                                                                    tb.append(`<tbody><tr title=${arr[i][5]}>` + 
                                                                    '<td style="width: 10;">' + '<i class="fas fa-image"></i>' + '</td>' + 
                                                                    '<td style="width: 22.5%;">' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">생성 도구</p>' + browser + '</td>' +
                                                                    '<td style="width: 22.5%;"><p style="font-weight: bold;">저장 위치</p>' + arr[i][5] + '</td>' +
                                                                    '<td style="width: 22.5%;"></td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                        }
                                                    }
                                                    if (document.getElementById('contents').value == 'msg'){
                                                        tb.empty();

                                                        tb.append('<thead><tr>' +
                                                        '<th style="width: 10%;">' + '</th>' +
                                                        '<th style="width: 22.5%;">' + '날짜 및 시간 (UTC+9)' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + '상태' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + '번호' + '</th>' +
                                                        '<th style="width: 22.5%;">' + '내용' + '</th>' +
                                                        '</tr></thead>');

                                                        for (var i=0; i<arr.length; i++){
                                                            if (arr[i][0] == 'm'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][5] == '2'){
                                                                        state = '발신'
                                                                    }else{
                                                                        state = '수신'
                                                                    }
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td>' + '<i class="fas fa-envelope"></i>' + '</td>' + 
                                                                    '<td>' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td>' + state + '</td>' +
                                                                    '<td>' + arr[i][2] + '</td>' +
                                                                    '<td>' + arr[i][3] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                        }
                                                    }
                                                    if (document.getElementById('contents').value == 'call'){
                                                        tb.empty();

                                                        tb.append('<thead><tr>' +
                                                        '<th style="width: 10%;">' + '</th>' +
                                                        '<th style="width: 22.5%;">' + '날짜 및 시간 (UTC+9)' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + '상태' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + '번호' + '</th>' +
                                                        '<th style="width: 22.5%;">' + '통화 시간 (초)' + '</th>' +
                                                        '</tr></thead>');

                                                        for (var i=0; i<arr.length; i++){
                                                            if (arr[i][0] == 'c'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][5] == '2'){
                                                                        state = '발신'
                                                                    }else if(arr[i][5] == '1'){
                                                                        state = '수신'
                                                                    }else{
                                                                        state = '부재중'
                                                                    }
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td>' + '<i class="fas fa-phone"></i>' + '</td>' + 
                                                                    '<td>' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td>' + state + '</td>' +
                                                                    '<td>' + arr[i][2] + '</td>' +
                                                                    '<td>' + arr[i][4] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                        }
                                                    }
                                                    if (document.getElementById('contents').value == 'internet'){
                                                        tb.empty();

                                                        tb.append('<thead><tr>' +
                                                        '<th style="width: 10%;">' + '</th>' +
                                                        '<th style="width: 22.5%;">' + '날짜 및 시간 (UTC+9)' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + '브라우저' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + 'URL' + '</th>' +
                                                        '<th style="width: 22.5%;">' + 'Title' + '</th>' +
                                                        '</tr></thead>');

                                                        for (var i=0; i<arr.length; i++){
                                                            if (arr[i][0] == 'i'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][5] == 'ch'){
                                                                        browser = 'Chrome'
                                                                    }else if(arr[i][5] == 's'){
                                                                        browser = 'Samsung Internet'
                                                                    }
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td>' + '<i class="fas fa-globe"></i>' + '</td>' + 
                                                                    '<td>' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td>' + browser + '</td>' +
                                                                    '<td>' + arr[i][2] + '</td>' +
                                                                    '<td>' + arr[i][3] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                        }
                                                    }
                                                    if (document.getElementById('contents').value == 'download'){
                                                        tb.empty();

                                                        tb.append('<thead><tr>' +
                                                        '<th style="width: 10;">' + '</th>' +
                                                        '<th style="width: 22.5%;">' + '날짜 및 시간 (UTC+9)' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + '다운로드 도구' + '</th>' + 
                                                        '<th style="width: 22.5%;">' + 'URI' + '</th>' +
                                                        '<th style="width: 22.5%;">' + '저장 위치' + '</th>' +
                                                        '</tr></thead>');

                                                        for (var i=0; i<arr.length; i++){
                                                            if (arr[i][0] == 'd'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    tb.append('<tbody><tr>' + 
                                                                    '<td>' + '<i class="fas fa-download"></i>' + '</td>' + 
                                                                    '<td>' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td>' + arr[i][3] + '</td>' +
                                                                    '<td>' + arr[i][4] + '</td>' +
                                                                    '<td>' + arr[i][5] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                }
                                                            }
                                                        }
                                                    }
                                                    if (document.getElementById('contents').value == 'media'){
                                                        tb.empty();

                                                        tb.append('<thead><tr>' +
                                                        '<th style="width: 10%;">' + '</th>' +
                                                        '<th style="width: 33.3%;">' + '날짜 및 시간 (UTC+9)' + '</th>' + 
                                                        '<th style="width: 33.3%;">' + '생성 도구' + '</th>' + 
                                                        '<th style="width: 33.3%;">' + '저장 위치' + '</th>' +
                                                        '</tr></thead>');

                                                        for (var i=0; i<arr.length; i++){
                                                            if (arr[i][0] == 'md'){
                                                                if (arr[i][1] >= startDate && arr[i][1] <= endDate){
                                                                    if (arr[i][4] == 'com.android.chrome'){
                                                                        browser = 'Chrome'
                                                                    }else if(arr[i][4] == 'com.sec.android.app.sbrowser'){
                                                                        browser = 'Samsung Internet'
                                                                    }else{
                                                                        browser = arr[i][3]
                                                                    }
                                                                    if(arr[i][5].match('gif|jpe?g|tiff|png|webp|bmp')){//사진 확장자
                                                                    
                                                                     tb.append(`<tbody><tr data-html="true" data-placement="left" class='list_data' title="<div style='float:right'><div class='feather icon-zoom-in'></div><div class='feather icon-zoom-out' style='display:none'></div><div class='feather icon-x'></div></div><img src=${arr[i][5]}/>">` + 
                                                                    '<td>' + '<i class="fas fa-image"></i>' + '</td>' + 
                                                                    '<td>' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td>' + browser + '</td>' +
                                                                    '<td>' + arr[i][5] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                    }else if(arr[i][5].match('mp4|m4v|avi|wmv')){//영상 확장자
                                                                    
                                                                     tb.append(`<tbody><tr data-html="true" data-placement="left" class='list_data' title="<div style='float:right'><div class='feather icon-zoom-in'></div><div class='feather icon-zoom-out' style='display:none'></div><div class='feather icon-x'></div></div><video width='320' height='240' src=${arr[i][5]} controls autoplay/>">` + 
                                                                    '<td>' + '<i class="fas fa-image"></i>' + '</td>' + 
                                                                    '<td>' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td>' + browser + '</td>' +
                                                                    '<td>' + arr[i][5] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                    }else{ //위의 두개가 아닌 확장자..
                                                                    tb.append(`<tbody><tr title=${arr[i][5]}>` + 
                                                                    '<td>' + '<i class="fas fa-image"></i>' + '</td>' + 
                                                                    '<td>' + arr[i][1].getFullYear() + '/' + leadingZeros(arr[i][1].getMonth() + 1, 2) + '/' + leadingZeros(arr[i][1].getDate(), 2) + ' ' + leadingZeros(arr[i][1].getHours(), 2) + ':' + leadingZeros(arr[i][1].getMinutes(), 2) + ':' + leadingZeros(arr[i][1].getSeconds(), 2) + '</td>' +
                                                                    '<td>' + browser + '</td>' +
                                                                    '<td>' + arr[i][5] + '</td>' +
                                                                    '</tr></tbody>'); 
                                                                    }
                                                                    
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            </script>
                                            
                                            <div class="table-responsive" style="height:700px;">
                                                <table class="table table-hover" id="contenthere">
                                                    <tbody>
                                                        <script>
                                                            cont('all');
                                                            
                                                        </script>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- [ Main Content ] end -->
                    </div>
                </div>
            </div>

        </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>

$(document).on('click','.list_data',function(){
        $(".list_data").tooltip({trigger: 'manual'}).tooltip('dispose');
        $(this).tooltip({placement: 'left',trigger: 'manual'}).tooltip('show');
         })
$(document).on('click','.icon-x',function(){
        $('.tooltip').tooltip({trigger: 'manual'}).tooltip('dispose');
         }) 
$(document).on('click','.tooltip-inner',function(){
         $('.tooltip-inner').toggleClass('tooltip-zoom')
         $('.icon-zoom-in').toggle()
         $('.icon-zoom-out').toggle()
         
         })  
</script>


{% endblock javascripts %}






